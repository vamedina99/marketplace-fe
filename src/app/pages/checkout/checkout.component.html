<div class="checkout-container animate-fadeIn">
  <h1 class="page-title">Pago</h1>

  <div class="checkout-steps">
    <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
      <div class="step-number">1</div>
      <div class="step-text">Información del Cliente</div>
    </div>
    <div class="step-connector"></div>
    <div class="step" [class.active]="currentStep === 2">
      <div class="step-number">2</div>
      <div class="step-text">Pago</div>
    </div>
  </div>

  <div class="checkout-content">
    <div class="checkout-main">
      <!-- Step 1: Customer Information -->
      <div *ngIf="currentStep === 1" class="checkout-form animate-fadeIn">
        <h2 class="form-title">Información del Cliente</h2>

        <form [formGroup]="customerForm" (ngSubmit)="nextStep()">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Nombre Completo</label>
              <input
                type="text"
                id="name"
                formControlName="name"
                [class.invalid]="customerForm.get('name')?.invalid && customerForm.get('name')?.touched"
              >
              <div class="error-message" *ngIf="customerForm.get('name')?.invalid && customerForm.get('name')?.touched">
                Por favor ingrese su nombre completo
              </div>
            </div>

            <div class="form-group">
              <label for="email">Correo Electrónico</label>
              <input
                type="email"
                id="email"
                formControlName="email"
                [class.invalid]="customerForm.get('email')?.invalid && customerForm.get('email')?.touched"
              >
              <div class="error-message" *ngIf="customerForm.get('email')?.invalid && customerForm.get('email')?.touched">
                Por favor ingrese un correo electrónico válido
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="address">Dirección</label>
            <input
              type="text"
              id="address"
              formControlName="address"
              [class.invalid]="customerForm.get('address')?.invalid && customerForm.get('address')?.touched"
            >
            <div class="error-message" *ngIf="customerForm.get('address')?.invalid && customerForm.get('address')?.touched">
              Por favor ingrese su dirección
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="city">Ciudad</label>
              <input
                type="text"
                id="city"
                formControlName="city"
                [class.invalid]="customerForm.get('city')?.invalid && customerForm.get('city')?.touched"
              >
              <div class="error-message" *ngIf="customerForm.get('city')?.invalid && customerForm.get('city')?.touched">
                Por favor ingrese su ciudad
              </div>
            </div>

            <div class="form-group">
              <label for="postalCode">Código Postal</label>
              <input
                type="text"
                id="postalCode"
                formControlName="postalCode"
                [class.invalid]="customerForm.get('postalCode')?.invalid && customerForm.get('postalCode')?.touched"
              >
              <div class="error-message" *ngIf="customerForm.get('postalCode')?.invalid && customerForm.get('postalCode')?.touched">
                Por favor ingrese su código postal
              </div>
            </div>

            <div class="form-group">
              <label for="country">País</label>
              <input
                type="text"
                id="country"
                formControlName="country"
                [class.invalid]="customerForm.get('country')?.invalid && customerForm.get('country')?.touched"
              >
              <div class="error-message" *ngIf="customerForm.get('country')?.invalid && customerForm.get('country')?.touched">
                Por favor ingrese su país
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="customerForm.invalid">
              Continuar al Pago
            </button>
          </div>
        </form>
      </div>

      <!-- Step 2: Payment Information -->
      <div *ngIf="currentStep === 2" class="checkout-form animate-fadeIn">
        <h2 class="form-title">Información de Pago</h2>

        <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()">
          <div class="form-group">
            <label for="cardNumber">Número de Tarjeta</label>
            <input
              type="text"
              id="cardNumber"
              formControlName="cardNumber"
              placeholder="1234567890123456"
              [class.invalid]="paymentForm.get('cardNumber')?.invalid && paymentForm.get('cardNumber')?.touched"
            >
            <div class="error-message" *ngIf="paymentForm.get('cardNumber')?.invalid && paymentForm.get('cardNumber')?.touched">
              Por favor ingrese un número de tarjeta válido de 16 dígitos
            </div>
          </div>

          <div class="form-group">
            <label for="cardHolder">Nombre en la Tarjeta</label>
            <input
              type="text"
              id="cardHolder"
              formControlName="cardHolder"
              [class.invalid]="paymentForm.get('cardHolder')?.invalid && paymentForm.get('cardHolder')?.touched"
            >
            <div class="error-message" *ngIf="paymentForm.get('cardHolder')?.invalid && paymentForm.get('cardHolder')?.touched">
              Por favor ingrese el nombre que aparece en la tarjeta
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="expiryDate">Fecha de Vencimiento (MM/AA)</label>
              <input
                type="text"
                id="expiryDate"
                formControlName="expiryDate"
                placeholder="MM/AA"
                [class.invalid]="paymentForm.get('expiryDate')?.invalid && paymentForm.get('expiryDate')?.touched"
              >
              <div class="error-message" *ngIf="paymentForm.get('expiryDate')?.invalid && paymentForm.get('expiryDate')?.touched">
                Por favor ingrese una fecha de vencimiento válida (MM/AA)
              </div>
            </div>

            <div class="form-group">
              <label for="cvv">CVV</label>
              <input
                type="text"
                id="cvv"
                formControlName="cvv"
                [class.invalid]="paymentForm.get('cvv')?.invalid && paymentForm.get('cvv')?.touched"
              >
              <div class="error-message" *ngIf="paymentForm.get('cvv')?.invalid && paymentForm.get('cvv')?.touched">
                Por favor ingrese un CVV válido
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="prevStep()">
              Atrás
            </button>
            <button
              type="submit"
              class="btn-primary"
              [disabled]="paymentForm.invalid || isSubmitting">
              {{ isSubmitting ? 'Procesando...' : 'Completar Pedido' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="checkout-summary">
      <h2 class="summary-title">Resumen del Pedido</h2>

      <div class="summary-items">
        <div *ngFor="let item of cartItems" class="summary-item">
          <div class="item-info">
            <span class="item-quantity">{{ item.quantity }}×</span>
            <span class="item-name">{{ item.product.name }}</span>
          </div>
          <span class="item-price">${{ getItemTotal(item).toFixed(2) }}</span>
        </div>
      </div>

      <div class="summary-divider"></div>

      <div class="summary-row">
        <span>Subtotal</span>
        <span>${{ cartTotal.toFixed(2) }}</span>
      </div>

      <div class="summary-row">
        <span>Envío</span>
        <span>Gratis</span>
      </div>

      <div class="summary-divider"></div>

      <div class="summary-row total">
        <span>Total</span>
        <span>${{ cartTotal.toFixed(2) }}</span>
      </div>
    </div>
  </div>
</div>
